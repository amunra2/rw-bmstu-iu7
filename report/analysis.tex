\chapter{Анализ предметной области}

В данном разделе будет рассмотрена актуальность темы, выбран объект генерации, а также рассмотрены проблемы генерации музыки и группы методов.

\section{Актуальность темы}

Вопрос автоматической генерации музыки является весьма важным в наше время. Данная технология находит широкое применение в различных областях.

Тема широко исследовалась, потому что считается, что все написание музыки можно алгоритмизировать. Поэтому было проведено множество экспериментов \cite{music-mood} с целью выявить закономерности в произведениях или разложить музыку на составляющие части. Все это нужно для того, чтобы понять -- какой фрагмент музыкального произведения вызывает те или иные эмоции и почему. Ответы на эти вопросы позволят написать эффективный алгоритм, который сможет правильно передать настроение, которое хочет получить пользователь и при этом очень быстро. Развитие данной темы привело к высокой потребности такого вида музыки.

Так, в сфере игр нередко саундтреки являются сгенерированы автоматически. В качестве примера можно привести специальную нейронную сеть под названием Neural Composer, которая была научена писать музыку на основе 4 тысяч различных композиций из видео игр \cite{neural-composer}. Данный инструмент может помочь добавить в приложение музыкальное сопровождение, которое при этом будет уникальным. Подобное желание обуславливается несколькими факторами, которые легко решаются использованием автоматического генератора:

\begin{itemize}
    \item невозможностью нанять музыканта для написания композиции;
    \item желанием получить уникальный, ранее не существовавший музыкальный фрагмент.
\end{itemize}

Применение автоматических генераторов является важной частью самой музыки. Существуют специальные приложения, такие как Guitar PRO или Finale. Эти приложения позволяют автоматизировать процесс написания. Они обладают следующими возможностями:

\begin{itemize}
    \item построить аккорд, имея заданную тональность;
    \item транспонировать произведение с одной тональности в другую;
    \item переписать музыкальное произведение на другой музыкальный инструмент.
\end{itemize}


\section{Виды музыкальных фрагментов}

При генерации произведения музыкальные фрагменты можно поделить на следующие виды \cite{music-types}.

\begin{enumerate}
    \item Ритм или партия для ударных инструментов.
    \item Аккомпанемент под мелодию из заранее заданного набора аккордов.
    \item Вариация уже готовой мелодии.
    \item Мелодия, где в один момент времени звучит не более одной ноты.
    \item Полифоническая музыка, то есть музыка, где используется в один момент времени более одного инструмента.
\end{enumerate}

Центральным видом в данной исследовательской работе является генерация полифонической музыки, поэтому речь далее идет именно об этом виде музыкального произведения.

\section{Проблемы при генерации музыки}

Поскольку написание музыки является глубоко творческим  процессом, следовательно программа должна соответствовать данному требованию, из-за чего возникает ряд проблем.

\subsection{Проблема креативности}

Проблема креативности является центральной проблемой, которую необходимо решить при написании автоматического генератора. Дело заключается не только в художественной стороне вопроса, но и в экономической \cite{music-issues}, поскольку при этом может возникнуть проблема с авторским правом. Генератор должен писать музыку, которая не похожа на ранее существующие мелодии, чтобы избежать данных проблем. Существует множество методов для решения этого вопроса, основанные на алгоритмах работы с текстом.

\subsection{Проблема глобальной структуры}

Произвольная комбинация нот может быть началом некоторой композиции. Продолжение первых комбинаций должно быть похоже на начало музыкальной композиции, иначе следующие комбинации будут похожи на начало нового произведения. Каждый последующий набор нот повторяет предыдущий или имеет некоторые изменения. 

Подобные замечания накладывают на модель требования -- уметь считать и копировать. Выполнить подобные требования необходимо для того, чтобы в итоге музыкальное произведение представляло из себя глобальную структуру. \cite{music-issues}. Однако при субъективном прослушивании результата ощутимо, что каждые 5-10 секунд произведение изменится, при этом оставаясь музыкой, что и называется проблемой глобальной структуры.

В качестве решения были предложены LSTM \cite{lstm} сети, однако они не подходят для копирования более 16-20 фрагментов, когда для музыкальной композиции может понадобиться 256 и более.


\subsection{Проблема интерактивности}

В соответствии с работой Роберта Роу \cite{music-issues}, интерактивная компьютерная музыкальная система - система, поведение которой меняется в ответ на музыкальный ввод.

В большинстве систем генерация автоматизирована, при этом с небольшим количеством интерактивности или совсем без нее. Из-за этого локальная модификация получившегося музыкального фрагмента обычно не поддерживается, из-за чего нужно делать полную регенерацию музыкального отрезка. Но суть заключается в том, что это не похоже на работу музыканта, который может изменить свое произведение в любой момент.


\section{Методы генерации музыки}

Можно выделить четыре основные группы методов, которые способны решить задачу генерации:

\begin{itemize}
    \item вероятностные;
    \item грамматические;
    \item методы искусственного интеллекта;
    \item биологические.
\end{itemize}


\subsection{Вероятностные методы}

Вероятностные методы имеют широкое распространение. Случайность уже давно используется для генерации музыки. Большинство методов, однако, сильно ограничены тем, что они полагаются на составителя, который уже создал возможные такты музыки, которые нужно собрать вместе. Другими словами, пользователь просто по-новому собирает воедино уже сочиненную музыку \cite{prob-methods}. При этом остается открытым следующий вопрос -- как же случайным образом создавать отдельные ноты, которые составляют такты. Вероятностные методы занимаются решением подобных вопросов, используя саму теорию вероятности, а также цепи Маркова.


\subsection{Грамматические методы}

Грамматические методы генерации музыки основаны на использовании грамматик, а также алгоритмов, которые используются для генерации текста. 

Задача состоит в том, чтобы четко сформулировать правила музыки или, по крайней мере, музыкального языка \cite{gram-methods}. Описание процесса композиции с помощью явных и формальных правил может быть использовано для программирования, автоматизации и моделирования определенных аспектов процесса музыкальной композиции.


\subsection{Методы искусственного интеллекта}

Применение методов искусственного интеллекта для генерации музыки имеет большое значение в генерации произведений. Музыка организована на множестве взаимосвязанных уровней абстракции, что делает ее своеобразным испытательным полигоном для методов искусственного интеллекта \cite{ai-methods}.

Первым этапом в решении множества задач с помощью средств искусственного интеллекта (ИИ) является сведение задачи к базовой проблеме, которая решается средствами ИИ. Одной из таких проблем является предсказание последовательности, которое используется в приложениях для перевода и обработки естественного языка. Нашу задачу по генерации музыки можно свести к проблеме предсказания последовательности, при этом предсказание будет выполняться для последовательности музыкальных нот.

Системы обучаются на основе большого количества музыкальных произведений или по некоторым правилам гармонии. Например, система \linebreak HARMONET обучалась на основе правил гармонии И. Баха.


\subsection{Биологические методы}

Суть биологических методов в том, что они напоминают биологические процессы. В них входят, например, генетический алгоритм и клеточные автоматы.

\section{Вывод}

В данном разделе была обоснована актуальность задачи, рассмотрены объекты, с которыми работают алгоритмы, а также описаны основные проблемы генерации музыки и группы, на которые делятся методы генерации.


\chapter{Классификация существующих методов}

В данном разделе будут рассмотрены методы генерации музыки, а также проведено их сравнение и оценка.

\section{Методы генерации муызыкальных произведений полифонического склада}

Далее будут приведены и описаны наиболее популярные методы генерации музыки.

\subsection{Марковские цепи}

\textbf{Цепь Маркова} - это модель, описывающая последовательность возможных событий. Эта последовательность должна удовлетворять предположению Маркова - вероятность следующего состояния зависит от предыдущего состояния, а не от всех предыдущих состояний в последовательности.

Это может звучать как упрощение реальных дел. Например, для применения цепочки Маркова для прогнозирования погоды нам нужно сделать предположение, что погода завтра зависит только от текущей погоды, и делать вид, что других факторов, таких как время года, например, нет.

Несмотря на это упрощение во многих случаях, мы сможем генерировать полезные прогнозы, но в то же время мы сможем быстрее решать нашу задачу, делая ее менее затратной в вычислительном отношении.

Модели цепей Маркова имеют множество применений в области финансов, обработки естественного языка и в любом месте, где у вас есть данные временных рядов.

К музыкальной композиции можно применить цепи Маркова \cite{prob-methods}, поскольку музыкальное произведение можно рассматривать как последовательность состояний, каждое из которых представляет из себя ноту определенной длины. Поскольку доступные ноты не бесконечны, варианты длины также не бесконечны, то категории состояния также должны быть конечны. Таким образом, цепи Маркова могут быть построены из предыдущих музыкальных произведений разных жанров и служить основой для алгоритма обучения для принятия вероятностных решений и создания новых музыкальных произведений в том же жанре. Использование Марковских цепей n-го порядка позволяет сгруппировать отдельные ноты вместе, создавая различные шаблоны и последовательности.

\subsection{Контекстно-зависимая грамматика}

\textbf{Контекстно-зависимая грамматика} (КЗ-грамматика, контекстная \linebreak  грамматика) \cite{kz-grammar} -- частный   случай формальной   грамматики, у которой  левые  и  правые  части  всех  продукций  могут  быть  окружены  терминальными  и не терминальными символами.

Суть использования кз-грамматик можно описать следующим примером. Изначально имеется строка: \textit{ABCDEFGIKFHLEFJ}. Для данной строки необходимо построить грамматику.

В качестве примера, возьмем символ F. Для данной буквы мы формируем правило, которое будет указывать на то, какая буква должна идти после F. Согласно начальной строке, после F могут идти буквы G, H и J. Поскольку нельзя однозначно выбрать одну из букв, нужно расширить контекст буквами, которые окружают F. Взяв по одной букве перед F, имеем следующие наборы букв -- EF и KF.

Теперь после KF идет только буква H, значит было получено первое правило: KF->H. Но после EF могут идти G и J, тогда снова расширяем контекст и получаем: DEF и LEF. Тогда конечный набор правил для буквы F имеет вид: KF->H, DEF->G, LEF->J.

Получаем набор правил, значит можно генерировать строку по заданной.

При этом возникает проблема: если генерировать новую последовательность по строго заданным правилам, то будет получаться исходная строка. Поэтому нужно брать промежуточные правила или конечные. Выбор осуществляется некоторым случайным образом, тогда строка в каждом из случаев будет уникальной.

Данный метод генерации применим не только для строк, но и для мелодий, поскольку букву можно заменить на определенную ноту или даже аккорд, при этом принцип генерации останется тот же.

КЗ-грамматика хорошо подходит для задачи генерации музыкальной партитуры в виде нот, однако требует определения чётких формальных правил построения композиции, что является крайне трудоёмким процессом.

\subsection{Л-системы}

\textbf{Л-система или система Линденмайера} -- это параллельная система перезаписи и тип формальной грамматики.

Правила грамматики Л-системы применяются итеративно, начиная с начального состояния. Максимально возможное количество правил применяется одновременно за итерацию. Тот факт, что на каждой итерации используется как можно больше правил, отличает Л-систему от формального языка, порожденного формальной грамматикой, которая применяет только одно правило на итерацию. Если бы продукционные правила применялись только по одному за раз, можно было бы довольно просто создать язык, а не Л-систему. Таким образом, Л-системы являются строгими подмножествами языков.

Работа  Л-системы  \cite{l-system}  начинается  с  определения  трех  наборов  параметров -- алфавита (список символов, которыми будет оперировать система, как на входе, так и на выходе, в нашем   случае,   например,   ноты),   набора   правил   (например,   классических   законов гармонии)  и  аксиомы  (символ  или  строка  символов  для  начального  ввода). Л-системы относятся к экспертным системам, основанным на знаниях и заданных наборов правил. К таким  системам  также  можно  отнести уже  упоминавшиеся  Марковские  цепи,  в  которых вероятность  перехода  от  одной  ноты  к  другой  вычисляется  на  основании  матрицы вероятностных переходов, исходя из заранее определенных статистических правил.

В основе работы Л-систем лежит набор правил замещения, рекурсивно применяющийся на начальную строку символов и интерпретирующий конечную строку, как структурные элементы организма. Правила замещения определяют, как каждый конкретный символ в текущем поколении должен быть перемещен. Применение Л-систем для генерации алгоритмических композиций подразумевает использование вместо символов определенных музыкальных параметров.


\subsection{Клеточные автоматы}

\textbf{Клеточные автоматы} -- это дискретные динамические системы, поведение которых полностью определяется в терминах локальных зависимостей. Пространство представлено равномерной сеткой, каждая ячейка или клетка которой содержит несколько битов данных; время идет вперед дискретными шагами, а законы мира выражаются единственным набором правил, скажем, небольшой справочной таблицей, по которой любая клетка на каждом шаге вычисляет своё новое состояние, основываясь на состояниях её близких соседей. Таким  образом,  законы  системы  являются  локальными  и повсюду одинаковыми.

Самым известным воплощением клеточных автоматов для генерации алгоритмических композиций является CAMUS. CAMUS генерирует мелодию на основе двух клеточных автоматов: игра в «жизнь» \cite{game-of-life} Джона Конвеема и Demon Cyclic Space Больцмана. CAMUS оперирует трехмерными версиями обоих автоматов параллельно. При каждом шаге живые ячейки Игры в жизнь используются для определения четырехнотных аккордов, в то время, когда координаты живых клеток определяют интервалы сыгранных нот. Базовый тон выбирается стохастическими методами (Марковскими цепями), и координата x живой клетки определяет интервал до следующей самой высокой ноты, координата y — дает полутоновый интервал, и, наконец, координата z дает последний интервал от второй самой высокой ноты до самой высокой.


\subsection{Генетический алгоритм}

\textbf{Генетический алгоритм (ГА)} \cite{gen-alg} — это эвристический алгоритм поиска, используемый для решения задач оптимизации и моделирования путём случайного подбора, комбинирования и вариации искомых параметров с использованием механизмов, напоминающих биологическую эволюцию. В общем смысле работа генетического алгоритма начинается с применения эквивалента биологического образования новых генов на пространство случайно распределенных решений для нахождения в итоге оптимального набора. 

Решения представлены хромосомами, а строки аллель — строками чисел, и задача рекомбинации генов заключается в создании новых аллелей из аллели, взятых от родительских хромосом посредством применения генетических операторов, в большинстве случаев это — мутация и скрещивание. Перебирание хромосом продолжается до достижения определенного условия экстремума. 

Генетические алгоритмы в задаче алгоритмической композиции разделяются по виду использованной \textit{фитнесс-функции} -- степень приспособленности хромосом может быть оценена исходя из заранее заданных определенных условий, либо может быть непосредственно человеком при прослушивании и субъективной оценке.

Первыми успешными исследованиями в области применения генетических алгоритмов в генеративной музыке можно считать изыскания Джона Бильса — профессора Рочестерского института технологий (Нью–Йорк, США). Он использовал ГА для имитации джазовой импровизации в собственном программном обеспечении GenJam \cite{gen-alg} (Genetic Jammer — Генетический Джэммер). Данная программа читает заранее подготовленные с помощью программы файлы, включающие партию аккордов пианино, баса, ритм–секции, и генерирует соло. Оценка происходит посредством человеческого восприятия. Посредством команд «g» или «b» («good» or «bad») слушатель оценивает сгенерированные куски как удачные или нет.


\subsection{Генеративно-состязательные сети}

\textbf{Генеративно-состязательная сеть (GAN)} \cite{gan} -- нейросеть, которая объединяет в себе две нейросети: генератор и дискриминатор, которые действуют друг против друга.

Задача генератора -- создать образ, а дискриминатор -- отличает настоящее от поддельного, то есть решает: относится ли образ к набору тренировочных или нет. Если дискриминатор распознал объект как подделку, то генератор снова пытается <<обмануть>> дискриминатора. Таким образом, нейросеть обучается благодаря <<противостоянию>> двух нейросетей, входящих в нее. Использование этой структуры позволяет обучать глубокие генеративные модели без дорогостоящих нормализующих констант. При этом этот метод доказал, что он позволяет создавать очень реалистичные выборки данных. Также для обучения в нейросеть загружается множество примеров музыкальных произведений, как современных, так и произведений классической музыки.


\subsection{Рекуррентные нейронные сети}

\textbf{Рекуррентные нейронные сети (RNN)} \cite{rnn} -- вид нейронных сетей, где связи между элементами образуют направленную последовательность. Благодаря этому появляется возможность обрабатывать серии событий во времени.

Рекуррентные нейронные сети часто используются для моделирования последовательностей данных.Сети могут использовать свою внутреннюю память для обработки. Эти модели обычно обучаются с использованием критерия максимального правдоподобия. Например, для языкового моделирования их обучают предсказывать следующую лексему в любой точке последовательности, то есть моделировать условную вероятность следующей лексемы при заданной последовательности предшествующих лексем. Путем выборки из этого условного распределения можно генерировать достаточно реалистичные последовательности. Выборка нетривиальна, и вы обычно прибегаете к поиску для создания хороших последовательностей в таких задачах, как машинный перевод. RNN использовались для моделирования музыки, используя при этом символьное представление.

Вариант использования -- \textbf{LSTM сети} \cite{lstm}, которые способны распознавать и кодировать долгосрочные шаблоны. Они крайне полезны в случае, когда сеть должна запоминать информацию в течение длительного периода времени, что и применяется при генерации музыки.


\section{Сравнение и оценка методов}

На основании описанных выше методов  для генерации музыки критерием оценки качества был выбран статистический опрос по музыкальному тесту Тьюринга.

Тест Тьюринга -- эмпирический тест, который заключался в следующем: человек взаимодействует с одним компьютером и одним человеком. На основании ответов на вопросы он должен определить, с кем он разговаривает -- с человеком или компьютерной программой. Задача компьютерной программы -- ввести человека в заблуждение, заставив сделать неверный выбор. Все участники теста не видят друг друга. Если судья не может сказать определённо, кто из собеседников является человеком, то считается, что машина прошла тест. При музыкальном тесте Тьюринга человеку предлагается отличить музыку, написанную человеком, и музыку, которую написала машина.

В нашем опросе было предложено по 2 музыкальные композиции для каждого из 7 методов -- одна композиция написана человеком, другая -- получена с использованием метода генерации музыки. Если человек делал неправильный выбор или сомневался -- считалось, что сгенерированный фрагмент прошел проверку. Высчитывалось процентное соотношение пройденных проверок к их общему количеству для каждого отдельно взятого метода генерации. Результаты опроса приведены в таблице \ref{tbl:survey_result}. 


\begin{center}
    \captionsetup{justification=raggedright,singlelinecheck=off}
    \begin{longtable}[c]{|l|l|}
    \caption{\label{tbl:survey_result} Результаты музыкального теста Тьюринга для каждого из методов}\\ \hline
        Метод & Процент успеха \\
        \hline
        Цепочка Маркова & 71\% \\
        \hline
        КЗ-грамматики & 91\% \\
        \hline
        Л-системы & 80\% \\
        \hline
        Клеточные автоматы & 74\% \\
        \hline
        Генетический алгоритм & 67\% \\
        \hline
        Генеративно-состязательные сети & 87\% \\
        \hline
        Рекуррентные нейронные сети & 83\% \\
        \hline
    \end{longtable}
\end{center}


Как видно из результатов, самым точным методом оказался метод с использованием контекстно-зависимых грамматик. Дело в том, что метод способен генерировать музыку высокого качества, если будет правильно подобран набор правил для генерации, что является крайне трудной задачей. Также высокий показатель у методов, основанных на нейронных сетях. За счет долгого обучения они способны показать высокое качество генерации музыкального фрагмента.


\section{Вывод}

В данном разделе были представлены и описаны методы генерации музыки, а также проведено их сравнение и оценка их качества на основании статистического критерия.
